<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>LD2450 Zone Manager - Professional mmWave Configuration</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23667eea'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-2-13h4v6h-4z'/%3E%3C/svg%3E">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="brand">
                    <div class="brand-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-2-13h4v6h-4z"/>
                            <circle cx="12" cy="16" r="2"/>
                        </svg>
                    </div>
                    <div class="brand-text">
                        <h1>LD2450 Zone Manager</h1>
                        <span class="tagline">Professional mmWave Configuration</span>
                    </div>
                </div>
                
                <div class="header-controls">
                    <div class="connection-status" id="connectionStatus">
                        <div class="status-indicator"></div>
                        <span>Connecting...</span>
                    </div>
                    <button class="icon-btn" id="settingsBtn" title="Settings">
                        <svg viewBox="0 0 24 24"><path d="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M10,22C9.75,22 9.54,21.82 9.5,21.58L9.13,18.93C8.5,18.68 7.96,18.34 7.44,17.94L4.95,18.95C4.73,19.03 4.46,18.95 4.34,18.73L2.34,15.27C2.21,15.05 2.27,14.78 2.46,14.63L4.57,12.97L4.5,12L4.57,11.03L2.46,9.37C2.27,9.22 2.21,8.95 2.34,8.73L4.34,5.27C4.46,5.05 4.73,4.96 4.95,5.05L7.44,6.05C7.96,5.66 8.5,5.32 9.13,5.07L9.5,2.42C9.54,2.18 9.75,2 10,2H14C14.25,2 14.46,2.18 14.5,2.42L14.87,5.07C15.5,5.32 16.04,5.66 16.56,6.05L19.05,5.05C19.27,4.96 19.54,5.05 19.66,5.27L21.66,8.73C21.79,8.95 21.73,9.22 21.54,9.37L19.43,11.03L19.5,12L19.43,12.97L21.54,14.63C21.73,14.78 21.79,15.05 21.66,15.27L19.66,18.73C19.54,18.95 19.27,19.04 19.05,18.95L16.56,17.95C16.04,18.34 15.5,18.68 14.87,18.93L14.5,21.58C14.46,21.82 14.25,22 14,22H10M11.25,4L10.88,6.61C9.68,6.86 8.62,7.5 7.85,8.39L5.44,7.35L4.69,8.65L6.8,10.2C6.4,11.37 6.4,12.64 6.8,13.8L4.68,15.36L5.43,16.66L7.86,15.62C8.63,16.5 9.68,17.14 10.87,17.38L11.24,20H12.76L13.13,17.39C14.32,17.14 15.37,16.5 16.14,15.62L18.57,16.66L19.32,15.36L17.2,13.81C17.6,12.64 17.6,11.37 17.2,10.2L19.31,8.65L18.56,7.35L16.15,8.39C15.38,7.5 14.32,6.86 13.12,6.62L12.75,4H11.25Z"/></svg>
                    </button>
                    <button class="icon-btn" id="themeToggle" title="Toggle theme">
                        <svg class="theme-icon" viewBox="0 0 24 24">
                            <path d="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18M20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31L23.31,12L20,8.69Z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Device Selection Panel -->
            <div class="device-panel">
                <div class="panel-header">
                    <h2>Device Configuration</h2>
                </div>
                <div class="panel-content">
                    <div class="device-selector">
                        <label for="deviceSelect">Select LD2450 Device:</label>
                        <select id="deviceSelect" class="select-input">
                            <option value="">Scanning for devices...</option>
                        </select>
                    </div>
                    
                    <div class="device-info" id="deviceInfo" style="display: none;">
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="label">Model:</span>
                                <span class="value" id="deviceModel">LD2450</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Firmware:</span>
                                <span class="value" id="deviceFirmware">—</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Range:</span>
                                <span class="value" id="deviceRange">—</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Angle:</span>
                                <span class="value" id="deviceAngle">—</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Visualization Area -->
            <div class="visualization-container">
                <div class="canvas-header">
                    <h3>Radar Visualization</h3>
                    <div class="canvas-controls">
                        <button class="btn btn-secondary" id="gridToggle">
                            <svg viewBox="0 0 24 24"><path d="M8,18H17V16H8V18M8,13H17V11H8V13M8,6V8H17V6H8M3,4A2,2 0 0,1 5,2H19A2,2 0 0,1 21,4V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V4M5,4V20H19V4H5Z"/></svg>
                            Grid
                        </button>
                        <button class="btn btn-secondary" id="persistenceToggle">
                            <svg viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"/></svg>
                            Trail
                        </button>
                        <button class="btn btn-secondary" id="fullscreenBtn">
                            <svg viewBox="0 0 24 24"><path d="M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z"/></svg>
                        </button>
                    </div>
                </div>
                
                <div class="canvas-wrapper" id="canvasWrapper">
                    <canvas id="radarCanvas" width="800" height="600"></canvas>
                    
                    <!-- Edit Mode Overlay -->
                    <div class="edit-overlay" id="editOverlay" style="display: none;">
                        <div class="edit-status">
                            <span id="editStatusText">Click and drag to create a zone</span>
                        </div>
                    </div>
                    
                    <!-- Coordinates Display -->
                    <div class="coordinates-display" id="coordinatesDisplay">
                        <span id="mouseCoordinates">X: —, Y: —</span>
                    </div>
                </div>
            </div>

            <!-- Zone Management Panel -->
            <div class="zones-panel">
                <div class="panel-header">
                    <h3>Zone Management</h3>
                    <div class="zone-actions">
                        <button class="btn btn-primary" id="editModeBtn">
                            <svg viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/></svg>
                            Edit Zones
                        </button>
                        <button class="btn btn-success" id="saveZonesBtn" disabled>
                            <svg viewBox="0 0 24 24"><path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/></svg>
                            Save All
                        </button>
                    </div>
                </div>
                
                <div class="panel-content">
                    <div class="zone-tabs">
                        <button class="tab-btn active" data-tab="detection">Detection Zones</button>
                        <button class="tab-btn" data-tab="exclusion">Exclusion Zones</button>
                    </div>
                    
                    <div class="zone-content">
                        <!-- Detection Zones -->
                        <div class="tab-panel active" id="detectionPanel">
                            <div class="zone-grid" id="detectionZones">
                                <!-- Zone cards will be generated here -->
                            </div>
                        </div>
                        
                        <!-- Exclusion Zones -->
                        <div class="tab-panel" id="exclusionPanel">
                            <div class="zone-grid" id="exclusionZones">
                                <!-- Exclusion zone cards will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Target Tracking Panel -->
            <div class="tracking-panel">
                <div class="panel-header">
                    <h3>Live Target Tracking</h3>
                    <div class="tracking-controls">
                        <button class="btn btn-secondary btn-sm" id="clearTrailBtn">Clear Trail</button>
                    </div>
                </div>
                
                <div class="panel-content">
                    <div class="targets-container">
                        <div class="target-card" id="target1">
                            <div class="target-header">
                                <span class="target-label">Target 1</span>
                                <div class="target-status inactive">Inactive</div>
                            </div>
                            <div class="target-details">
                                <div class="detail-row">
                                    <span class="detail-label">Position:</span>
                                    <span class="detail-value">—</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Speed:</span>
                                    <span class="detail-value">—</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Distance:</span>
                                    <span class="detail-value">—</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="target-card" id="target2">
                            <div class="target-header">
                                <span class="target-label">Target 2</span>
                                <div class="target-status inactive">Inactive</div>
                            </div>
                            <div class="target-details">
                                <div class="detail-row">
                                    <span class="detail-label">Position:</span>
                                    <span class="detail-value">—</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Speed:</span>
                                    <span class="detail-value">—</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Distance:</span>
                                    <span class="detail-value">—</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="target-card" id="target3">
                            <div class="target-header">
                                <span class="target-label">Target 3</span>
                                <div class="target-status inactive">Inactive</div>
                            </div>
                            <div class="target-details">
                                <div class="detail-row">
                                    <span class="detail-label">Position:</span>
                                    <span class="detail-value">—</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Speed:</span>
                                    <span class="detail-value">—</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Distance:</span>
                                    <span class="detail-value">—</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Settings Modal -->
        <div class="modal" id="settingsModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Settings</h3>
                    <button class="icon-btn" id="closeSettingsBtn">
                        <svg viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/></svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <h4>Connection</h4>
                        <div class="setting-item">
                            <label for="haUrl">Home Assistant URL:</label>
                            <input type="url" id="haUrl" placeholder="http://homeassistant.local:8123">
                        </div>
                        <div class="setting-item">
                            <label for="haToken">Access Token:</label>
                            <input type="password" id="haToken" placeholder="Long-lived access token">
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>Visualization</h4>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="showGrid" checked>
                                Show grid overlay
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="enablePersistence">
                                Enable target trails
                            </label>
                        </div>
                        <div class="setting-item">
                            <label for="refreshRate">Refresh rate (ms):</label>
                            <input type="number" id="refreshRate" value="500" min="100" max="5000" step="100">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="resetSettingsBtn">Reset</button>
                    <button class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
                </div>
            </div>
        </div>

        <!-- Zone Editor Modal -->
        <div class="modal" id="zoneEditorModal" style="display: none;">
            <div class="modal-content large">
                <div class="modal-header">
                    <h3 id="zoneEditorTitle">Edit Zone</h3>
                    <button class="icon-btn" id="closeZoneEditorBtn">
                        <svg viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/></svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="zone-editor-content">
                        <div class="editor-section">
                            <h4>Zone Properties</h4>
                            <div class="form-grid">
                                <div class="form-item">
                                    <label for="zoneName">Zone Name:</label>
                                    <input type="text" id="zoneName" placeholder="Enter zone name">
                                </div>
                                <div class="form-item">
                                    <label for="zoneType">Zone Type:</label>
                                    <select id="zoneType">
                                        <option value="detection">Detection Zone</option>
                                        <option value="exclusion">Exclusion Zone</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4>Coordinates (mm)</h4>
                            <div class="coordinates-grid">
                                <div class="form-item">
                                    <label for="zoneX1">X1 (Left):</label>
                                    <input type="number" id="zoneX1" min="-4000" max="4000" step="10">
                                </div>
                                <div class="form-item">
                                    <label for="zoneY1">Y1 (Near):</label>
                                    <input type="number" id="zoneY1" min="0" max="6000" step="10">
                                </div>
                                <div class="form-item">
                                    <label for="zoneX2">X2 (Right):</label>
                                    <input type="number" id="zoneX2" min="-4000" max="4000" step="10">
                                </div>
                                <div class="form-item">
                                    <label for="zoneY2">Y2 (Far):</label>
                                    <input type="number" id="zoneY2" min="0" max="6000" step="10">
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4>Zone Preview</h4>
                            <div class="zone-preview">
                                <canvas id="zonePreviewCanvas" width="400" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" id="deleteZoneBtn">Delete Zone</button>
                    <button class="btn btn-secondary" id="cancelZoneEditBtn">Cancel</button>
                    <button class="btn btn-primary" id="saveZoneBtn">Save Zone</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>